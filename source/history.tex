%!TEX root = io2d.tex
\addtocounter{chapter}{-1} % Make this Clause 0 instead of 1
\rSec0[\iotwod.revisionhistory]{Revision history}

\rSec1 [\iotwod.revisionhistory.r9] {Revision 9}

\pnum
Formatting and typo fixes.

\pnum
\tcode{rgba_color} is no longer premultiplied. Users can apply premultiplication themselves if they wish. This change allowed the setters to directly set a value rather than be modified by the alpha value, or in the case of the alpha setter modifying all other values.

\pnum
The solid color \tcode{basic_brush} ctor now takes its \tcode{rgba_color} argument by value rather than reference.

\rSec1 [\iotwod.revisionhistory.r8] {Revision 8}

\pnum
Modified the revision 7 notes (\ref{\iotwod.revisionhistory.r7}) to denote trademarks where applicable, and to use the correct capitalization for the cairo graphics library. The contents of those notes is otherwise unchanged.

\pnum
Changed the Revision history \clause, to be \clause 0.

\pnum
Added a new \clause, Graphics math (\ref{\iotwod.graphmath}), which defines the requirements of a type that conforms to the \graphicsmathtemplparam template parameter used by various classes.

\pnum
Updated the relevant class member functions in this proposal to define their effects to include calls to the appropriate \graphicsmathtemplparam functions. This completes the work, begun in P0267R7, of abstracting the implementation of the linear algebra and geometry classes, thereby allowing users to specify a preferred implementation of the mathematical functionality used in this proposal.

\pnum
Added a new \clause, Graphics surfaces (\ref{\iotwod.graphsurf}), which defines the requirements of a type that conforms to the \graphicssurfacestemplparam template parameter used by various classes.

\pnum
Updated the relevant class member functions in this proposal to define their effects to include calls to the appropriate \graphicssurfacestemplparam functions. This completes the work, begun in P0267R7, of abstracting the implementation of the brush, paths, surface state, and surface classes, thereby allowing users to specify a preferred implementation of the functionality specified in this proposal.

\pnum
Added a new \clause, Surface state props (\ref{\iotwod.surfacestate}) and moved the relevant \tcode{enum class} types and the \tcode{basic_render_props}, \tcode{basic_brush_props}, \tcode{basic_clip_props}, \tcode{basic_stroke_props}, and \tcode{basic_mask_props} class templates to it. 

\pnum
Added Michael Kazakov as a co-author. He has written an implementation of this proposal using the Core Graphics framework of Cocoa\textregistered{}, thus providing a native implementation for iOS\textregistered{} and OS X\textregistered{}. It is available as part of the reference implementation (See \ref{\iotwod.revisionhistory.r7}).

\pnum
He has also written a series of tests for compliance. This has drawn attention to several issues that have require some revision.

\pnum
Eliminated \tcode{format::rgb16_565} and \tcode{format::rgb30}.

\pnum
Eliminated \tcode{compositing_op::dest} since it is a no-op.

\pnum
Significant cleanup of terms and definitions.

\pnum
Added overload of \tcode{copy_surface} for \tcode{basic_output_surface}.

\pnum
Removed \tcode{format_stride_for_width}; it has had no use since mapping functionality was removed.

\pnum
Added functions \tcode{degrees_to_radians} and \tcode{radians_to_degrees}.

\pnum
Added equality comparison operators for a number of classes.

\pnum
Removed the copyright notice that stated that the proposal was copyrighted by ISO/IEC. Neither organization, jointly or severally, made any contribution to this document and no assignment of interests by the authors to either organization, jointly or severally, has ever been executed. The notice was there unintentionally and its presence in all revisions of P0267 was a mistake.

\pnum
Added \tcode{basic_dashes} which was added in R7 but had its description omitted accidentally.

\pnum
Removed the mandate of underlying layout of pixel formats in \tcode{enum class format} and made it and, the interpretation of the data (i.e. what each bit value in each channel means), and whether data is in a premultiplied format implementation defined.

\pnum
Added \tcode{GraphicsSurfaces::additional_formats} This allows implementations to support additional visual data formats.

\pnum
Eliminated all \tcode{flush} and \tcode{mark_dirty} member functions. These only existed to allow users to modify surfaces externally. Implementations that wish to allow users to modify surfaces externally should provide and document their own functionality for how to do that. The errors, etc., are all implementation dependent anyway so a uniform calling interface provides no benefit at all in the current templated-design.

\pnum
Renamed \tcode{enum class refresh_rate} to \tcode{refresh_style} to more accurately reflect its meaning. This was already done in parts of the R7; it is now complete.

\pnum
Changed the order of items in the \tcode{basic_figure_items::figure_item} type alias from alphabetical to grouping by function (e.g. \tcode{abs_new_figure}, \tcode{rel_new_figure}, and \tcode{close_figure} are grouped together and \tcode{abs_line} and \tcode{rel_line} are grouped together). While it's not expected that any new figure item types will be added, there is no chance that the existing ones will be augmented with additional types. So if new figure items are added, grouping by type will simply add them to the end, thus preserving the validity of the existing index values without having the existing entries be alphabetized and new entries not being alphabetized.

\pnum
Moved the class template definitions for the nested classes within basic_figure_items<GraphicsSurfaces> to the descriptions of each of those types from the synopsis of basic_figure_items<GraphicsSurfaces> itself.

\pnum
Added \tcode{format::xrgb16}. The number of bits per channel is left to the implementation since, e.g., Windows\textregistered{} is 565 whereas OS X\textregistered{} and iOS\textregistered{} are 555 with an unused bit. This is useful for platforms with limited memory where supported so having it as an official enumerator will help. 

\pnum
Users can now request a different output device format when calling the overloads of the basic_output_surface ctor and the basic_unmanaged_output_surface ctor that take separate output device width and height preferences.

\pnum
Eliminated \tcode{redraw_required} from \tcode{basic_unmanaged_output_surface}. Users can and should track the need to redraw in their own code when they manage the output device.

\pnum
Eliminated \tcode{user_scaling_callback} functionality from \tcode{basic_output_surface} and \tcode{basic_unmanaged_output_surface} since the output device is intentionally not fully specified (same as stdout, etc.).

\pnum
\tcode{begin_show} now returns void instead of int and has an error_code overload in case the user tries to show more output surfaces than the system permits.

\pnum
\tcode{render_props} now has a \tcode{filter} instead of an \tcode{antialias}.

\pnum
\tcode{stroke_props} now has an \tcode{antialias} instead of a \tcode{filter}.

\pnum
New type \tcode{basic_fill_props} for parameters specific to the fill operation.

\pnum
Removed the \tcode{fill_rule} from \tcode{basic_brush_props} as it was only being used for fill operations.

\rSec1 [\iotwod.revisionhistory.r7] {Revision 7}

\pnum
The significant difference between R7 and R6 is the abstraction of the implementation into separate classes. These classes provide math and rendering support. The linear algebra and geometry classes are templated over any appropriate math support class, while the path, brush and surface classes are templated over any appropriate rendering support class.

\pnum
The reference implementation of this paper provides a software implementation of the math and rendering support classes. This is based on cairo; indeed, so far the reference implementation has been based on cairo. However, it is now possible to provide an implementation more appropriate to the target platform.

\pnum
For example, a Windows\textregistered implementation could provide support classes based on DirectX\textregistered, while a Linux\textregistered implementation could provide support classes based on OpenGL\textregistered. In fact, any hardware vendor could provide a support library, targeting a specific implementation and their particular silicon if they wanted to exploit particular features of their hardware.

\pnum
Additionally, the surface classes have been modified: now there are simply managed and unmanaged output surfaces, the latter of which offers developers the opportunity to take finer control of the drawing surface

\pnum
The modified classes are as follows

\begin{libreqtab2}
	{Class identifiers modified since R6}
	{tab:\iotwod.revisionhistory.changedclasses}
	\\ \topline
	\lhdr{R6 identifier}
	& \rhdr{R7 identifier}
	\\ \capsep
	\endfirsthead
	\hline
	\lhdr{R6 identifier}
	& \rhdr{R7 identifier}
	\\ \capsep
	\endhead
	\tcode{vector_2d}
	& \tcode{basic_point_2d}
	\\
	\tcode{matrix_2d}
	& \tcode{basic_matrix_2d}
	\\
	\tcode{rectangle}
	& \tcode{basic_bounding_box}
	\\
	\tcode{circle}
	& \tcode{basic_circle}
	\\
	\tcode{path_group}
	& \tcode{basic_interpreted_path}
	\\
	\tcode{path_builder}
	& \tcode{basic_path_builder}
	\\
	\tcode{color_stop}
	& \tcode{gradient_stop}
	\\
	\tcode{brush}
	& \tcode{basic_brush}
	\\
	\tcode{render_props}
	& \tcode{basic_render_props}
	\\
	\tcode{brush_props}
	& \tcode{basic_brush_props}
	\\
	\tcode{clip_props}
	& \tcode{basic_clip_props}
	\\
	\tcode{stroke_props}
	& \tcode{basic_stroke_props}
	\\
	\tcode{mask_props}
	& \tcode{basic_mask_props}
	\\
	\tcode{image_surface}
	& \tcode{basic_image_surface}
	\\
	\tcode{display_surface}
	& \tcode{basic_output_surface}
	\\
\end{libreqtab2}

\pnum
The \tcode{surface} class and the \tcode{mapped_surface} class have been withdrawn, while the \tcode{basic_unmanaged_output_surface} class has been introduced.

\pnum
The reference implementation, including a software-only implementation of math and rendering support classes, is available at https://github.com/mikebmcl/P0267_RefImpl

\rSec1 [\iotwod.revisionhistory.r6] {Revision 6}

\pnum
Presented to LEWG in Toronto, July 2017